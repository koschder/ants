\section{Aufbau Bot}
\label{sec:module.AufbauBot}

Nun folgt der mehrstufige Aufbau des Bots, den wir geschrieben haben.

\subsection{Klasse Bot}
\label{sec:module.Bot.Bot}

\begin{figure}[H]
\centering
\includegraphics[width=0.7\textwidth]{91_bilder/antsBot}
\caption{Vererbung der Bots wobei auf Stufe impl (Implementation) nur MyBot verwendet wird.}
\label{fig:antsBot}
\end{figure}

Als Basis für unsere Bot Implementation haben wir den Beispiel-Bot (Klasse Bot.java) verwendet, der im Java-Starter-Package enthalten ist. Das Starter-Package kann von der AI-Challenge Website\footnote{http://aichallenge.org/ants\_tutorial.php} heruntergeladen werden. Der Bot implementiert die Klassen AbstractSystemInputReader und AbstractSystemInputParser, welche die Interaktion mit der Spielengine über die System-Input/Output Streams kapseln. Für eine optimierte Lösung könnte der Bot auch angepasst werden, indem er selber auf die Streams zugreift. Im Rahmen dieser Arbeit erschien uns das nicht nötig. Die Klasse Bot dient als Grundlage für die Klasse BaseBot, welcher wiederum Grundlage ist für die Finale Klasse MyBot. (Siehe Vererbung Abb. \ref{fig:antsBot})



\subsection{BaseBot}
\label{sec:module.Bot.BaseBot}

Die abstrakte Klasse BaseBot erbt vom Bot. Hier haben wird die Struktur unseres Spielzuges definiert.

\subsection{Ablauf eines Zugs} 
\label{sec:implementation.Bot.Turn}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{91_bilder/FirstTurn}
\caption{Ablauf des ersten Zugs des Spiels}
\label{fig:firstTurn}
\end{figure}

Abbildung \ref{fig:firstTurn} zeigt den Ablauf des ersten Zugs, während Abbildung \ref{fig:turn} den Ablauf aller weiteren Züge zeigt. 

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{91_bilder/Turn}
\caption{Ablauf der weiteren Züge des Spiels}
\label{fig:turn}
\end{figure}

Jeder Zug beginnt mit dem Einlesen des Inputs vom SystemInputStream. Wenn der Bot das Signal ''READY`` (1. Zug) oder ''GO`` (alle weiteren Züge) erhält, kann er den gesammelten Input verarbeiten (Methode \texttt{parseSetup()} respektiv \texttt{parseUpdate()}). Danach wird die eigentliche Logik des Bots in der Methode \texttt{doTurn(...)} ausgeführt.

Im 1. Zug werden dabei Instanzen der Tasks erstellt. Abgesehen davon unterscheidet sich der 1. Zug von diesem Punkt an nicht mehr von allen nachfolgenden Zügen. Die Tasks werden vorbereitet. (Aufruf der jeweiligen \texttt{setup()} Methode. Danach werden einige statistische Werte aktualisiert und in jedem 10. Zug auch geloggt. Dann werden die Tasks in der definierten Reihenfolge aufgerufen. Hier wird der Löwenanteil der Zeit verbracht, denn die Tasks enthalten die eigentliche Logik unserer Ameisen.

Zum Schluss werden dann mit \texttt{issueOrders()} die Züge der Ameisen über den SystemOutputStream an die Spielengine übergeben. Im Code sieht das ganze folgendermassen aus.

\lstset{language=Java, tabsize=4}
\begin{lstlisting}[caption=Der Ablauf des Spielzuges]
\label{lst:ablaufspielzug}
@Override
/*
 * This is the main loop of the bot. All the actual work is
 * done in the tasks that are executed in the order they are defined.
 */
public void doTurn() {
		// write current turn number, ants amount into the log file.
	addTurnSummaryToLogfiles();
		// new calculation of the influence map
	calculateInfluence();
		// write some statistics about our population
	doStatistics();
		// initialize the task (abstract method) must be implemented by the inherited class
	initTasks();
		// execute all task (main work to do here)
	executeTask();
		// write all orders to the output stream
	Ants.getOrders().issueOrders();
		// log all ants which didn't get a job.
	logUnemployedAnts();
}
\end{lstlisting}


\subsection{MyBot}
\label{sec:module.Bot.MyBot}

Wie bereits im Listining \ref{lst:ablaufspielzug} sichtbar, ist die Methode \texttt{initTasks()} in BaseBot abstrakt und muss von MyBot implementiert werden. \texttt{initTasks()} definiert welche Tasks, oder besser gesagt Fähigkeiten der Bot hat. Dies wurde ausgelagert, da nicht nur MyBot von BaseBot erbt, sondern auch weiter Bots die wir zu Testzwecken erstellt haben um nur gewisse Funktionalitäten zu testen. (Siehe dazu \ref{sec:testCenter.Testbots}) Weiter wird in MyBot \texttt{initLogging(...)} aufgerufen. Hier definieren wir welche Logkategorien mit welchem Loglevel ins Logfile geschrieben werden. (Mehr zum Thema Logging, siehe Kapitel \ref{sec:module.Logging}) Je nach Modul das gerade getestet wird kann die Anzahl Logeinträge justiert werden.\\
MyBot initialisiert folgende Tasks; es sind die Tasks die sich während der Arbeit bewährt haben. Die detaillierte Beschreibung der Tasks ist im nachfolgenden Kapitel \ref{sec:module.Tasks} zu finden.

\begin{itemize}
		\item GatherFoodTask
		\item AttackHillsTask
		\item DefendHillTask
		\item ExploreTask
		\item ClearHillTask
		\item CombatTask
		\item ClusteringTask
\end{itemize}